import{r as g,A as f,u as N,j as e,a as x,e as h,b as k,c as w,t as S,d as I,i as E}from"./index-CpWNu6MS.js";function L(){const{labelList:n,setLabelList:c}=g.useContext(f),[o,u]=g.useState(""),[l,i]=g.useState(void 0),{toast:d}=N(),y=a=>{const{value:t}=a.target;u(t)},j=async a=>{try{await x.put("/labels/define-default",{id:a}),c(t=>t.map(s=>s.id===a?{...s,default:!0}:{...s,default:!1}))}catch(t){d.error(h(t))}},C=a=>{i(a.id),u(a.name)},v=async a=>{a.preventDefault();let t;try{if(l){t=d.loading("Updating label...");const{data:s}=await x.put("/labels/edit/"+l,{label:o});let p=n.map(m=>m.id===l?{...m,name:o}:m);p=p.sort((m,b)=>m.category&&b.category?m.category.localeCompare(b.category):0),c(p),d.success(s.msg,t)}else{t=d.loading("Adding label...");const{data:s}=await x.post("/labels/add",{label:o}),p=[...n,s.label].sort((m,b)=>m.name.localeCompare(b.name));c(p),d.success(s.msg,t)}i(void 0),u("")}catch(s){d.error(h(s),t)}},r=async a=>{const t=d.loading("Deleting label...");try{const{data:s}=await x.delete("/labels/"+a);c(p=>p.filter(m=>m.id!==a)),d.success(s.msg,t)}catch(s){d.error(h(s),t)}};return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Label name"}),e.jsx("ul",{children:n.length>0?n.map((a,t)=>e.jsxs("li",{children:[e.jsx("p",{className:a.default?"active":"",onClick:()=>j(a.id),children:`${a.name} ${a.default?"(default)":""}`}),e.jsx("button",{onClick:()=>C(a),children:e.jsx("img",{src:"static/img/icons/edit.svg",alt:""})}),e.jsx("button",{onClick:()=>r(a.id),children:e.jsx("img",{src:"static/img/icons/delete.svg",alt:""})})]},t)):e.jsx("li",{className:"no-data",children:e.jsx("p",{className:"fs-italic ",children:"No label"})})}),e.jsxs("form",{id:"add-label-form",onSubmit:v,children:[e.jsx("input",{type:"text",value:o,onChange:y}),e.jsx("input",{type:"submit",value:l?"Edit":"Add"})]})]})}const T={type:"tfod",tags:[]};function D(){const{resetPopup:n,setImageList:c}=g.useContext(f),[o,u]=g.useState(T),{toast:l}=N(),{socket:i}=k(),{fetchImage:d,checkAndDeleteImage:y}=w(),j=r=>{const{value:a}=r.target;(a==="tfod"||a==="json")&&u(t=>({...t,type:a}))},C=r=>{const a=r.target.name,t=o.tags.includes(a)?o.tags.filter(s=>s!==a):[...o.tags,a];u(s=>({...s,tags:t}))},v=async()=>{const r=l.loading("Exporting data...");i.on(r),n(),c(t=>t.map(s=>({...s,error:!1})));const a=await l.executeSuccesWithCancel();await Promise.all(a.map(t=>t&&y(t)).filter(Boolean));try{console.log(o);const t=await x.post("/export/data",o,{responseType:"blob"});I(t),l.delete(r)}catch(t){E(t.message)?(t=JSON.parse(t.message),c(s=>s.map(p=>(p.id===t.imageId&&(p.error=!0),p))),await d(t.imageId),l.error(t.msg,r)):l.error(h(t),r)}};return e.jsxs("div",{className:"flex-col-gap-20",children:[e.jsxs("div",{className:"radios-wrapper",children:[e.jsx("input",{type:"radio",name:"module-type",className:"disp-n",id:"tfod-radio",value:"tfod",checked:o.type==="tfod",onChange:j}),e.jsx("label",{id:"tfod-radio-label",htmlFor:"tfod-radio",className:o.type==="tfod"?"active":"",children:"TFOD"}),e.jsx("input",{type:"radio",name:"module-type",className:"disp-n",id:"classifer-radio",value:"json",checked:o.type==="json",onChange:j}),e.jsx("label",{id:"classifer-radio-label",htmlFor:"classifer-radio",className:o.type==="json"?"active":"",children:"JSON"})]}),e.jsxs("div",{children:[e.jsx("p",{children:"Choose tags"}),e.jsx("div",{className:"tag-color-choice",children:S.map((r,a)=>e.jsxs("div",{className:`tag ${o.tags.includes(r.name)?"active":""}`,children:[e.jsx("input",{type:"checkbox",className:"disp-n",name:r.name,id:r.name+"-tag-box",checked:o.tags.includes(r.name),onChange:C}),e.jsx("label",{htmlFor:r.name+"-tag-box",children:e.jsx("span",{style:{backgroundColor:r.name}})})]},a))})]}),e.jsx("button",{className:"export-btn",onClick:v,children:"Export"})]})}function $(){const{trainData:n,setActiveImg:c}=g.useContext(f),{toast:o}=N(),u=async l=>{try{const{data:i}=await x.get("/images/get-image-by-label-id/"+l.id);c(i)}catch(i){o.error(h(i))}};return e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsx("li",{children:`Total images: ${n.imgCount}`}),e.jsx("li",{children:`Total labels: ${n.labelCount}`}),e.jsx("li",{children:`Unlabeled images: ${n.unlabeled}`}),e.jsxs("li",{children:[e.jsx("p",{children:"Tags:"}),n.tags.map((l,i)=>e.jsx("p",{children:`- ${l.tag}: ${l.count}`},i))]}),e.jsxs("li",{children:[e.jsx("p",{children:"Used labels:"}),n.labels.map((l,i)=>e.jsx("p",{className:"curs-p",onClick:()=>u(l),children:`- ${l.name}: ${l.count}`},i))]})]})})}function F(){const{popup:n,resetPopup:c}=g.useContext(f);return e.jsxs("div",{id:"popup",className:n.type,children:[e.jsxs("h2",{children:[n.type==="label-map"&&"Label map",n.type==="export"&&"Export settings",n.type==="data"&&"Informations"]}),n.type==="label-map"&&e.jsx(L,{}),n.type==="export"&&e.jsx(D,{}),n.type==="data"&&e.jsx($,{}),e.jsx("button",{className:"close-btn",onClick:()=>c(),children:e.jsx("img",{src:"static/img/icons/close.svg",alt:""})})]})}export{F as default};
